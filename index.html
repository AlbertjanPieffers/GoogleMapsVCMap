<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live GPS Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>

    <h2>üìç Live GPS Locatie</h2>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // üîπ Traccar API Configuratie
        const TRACCAR_SERVER = "http://45.55.84.20:8082"; // Vervang met jouw Traccar-server
        const TRACCAR_USERNAME = "Reclameappie@gmail.com"; // Vervang met jouw gebruikersnaam
        const TRACCAR_PASSWORD = "xy3s9e6k"; // Vervang met jouw wachtwoord
        const DEVICE_ID = 441821; // Vervang met het juiste device ID

        // üîπ Basis-authenticatie maken
        const authHeader = "Basic " + btoa(TRACCAR_USERNAME + ":" + TRACCAR_PASSWORD);

        // üîπ Kaart initialiseren met Leaflet.js
        let map = L.map('map').setView([52.370216, 4.895168], 15); // Amsterdam als startpositie
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
        let marker = L.marker([52.370216, 4.895168]).addTo(map); // Dummy marker

        // üîπ Functie om GPS-locatie van Traccar op te halen
        async function fetchGPSLocation() {
            try {
                const response = await fetch(`${TRACCAR_SERVER}/api/positions`, {
                    method: "GET",
                    headers: { "Authorization": authHeader }
                });

                if (!response.ok) {
                    console.error("‚ùå Fout bij ophalen GPS-data:", response.status);
                    return;
                }

                const data = await response.json();
                console.log("üì° Traccar API Response:", data);

                // Zoek de juiste device-locatie
                const position = data.find(pos => pos.deviceId === DEVICE_ID);
                if (position) {
                    updateMap(position.latitude, position.longitude);
                }
            } catch (error) {
                console.error("‚ùå API Fout:", error);
            }
        }

        // üîπ Functie om kaart en marker bij te werken
        function updateMap(lat, lon) {
            console.log(`üìç GPS Update: Lat ${lat}, Lon ${lon}`);

            marker.setLatLng([lat, lon]); // Verplaats de marker
            map.setView([lat, lon]); // Focus de kaart op de nieuwe locatie
        }

        // üîπ Haal elke 10 seconden nieuwe GPS-data op
        fetchGPSLocation();
        setInterval(fetchGPSLocation, 10000);
    </script>
//Change
</body>
</html>
